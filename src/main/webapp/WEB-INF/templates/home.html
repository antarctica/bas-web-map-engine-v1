<!DOCTYPE html>
<html lang="en">
    <head th:include="console_fragments/header :: ${debug} ? 'debug_layout' : 'layout'">        
    </head>
    <body>
        <div id="background"></div>
        <div id="wrapper">
            <div th:include="fragments/nav :: layout"></div>
            <div class="container" id="map-gallery"></div>
            <div class="container" style="margin-top: 10px" th:switch="${#httpServletRequest.remoteUser}">
                <button id="console-log-in-create" th:case="null" type="button" class="btn btn-primary"
                 data-toggle="tooltip" data-placement="right" title="Go to login page to create or edit maps">Log in</button>
                <div th:case="*">
                    <button id="console-create-new-map"  type="button" class="btn btn-primary"
                     data-toggle="tooltip" data-placement="top" title="Open map creation interface (new tab)">Create a new map</button>
                    <button id="console-clear-tn-cache" type="button" class="btn btn-primary"
                     data-toggle="tooltip" data-placement="top" title="Clear the cache of map thumbnail images - recompute on next reload">Delete map thumbnails</button>                
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            var bg = [[${background}]];           
            /*]]>*/
        </script>
        <script type="text/javascript">

            jQuery(document).ready(function () {

                jQuery('[data-toggle="tooltip"]').tooltip({container: 'body'});
                /* For dynamic tooltips - http://stackoverflow.com/questions/9958825/how-do-i-bind-twitter-bootstrap-tooltips-to-dynamically-created-elements */
                jQuery("body").tooltip({ selector: '[data-toggle="tooltip"]'});
               
                /* Login behaviour */
                jQuery("#log-in-user").click(function (evt) {
                    window.location = magic.config.paths.baseurl + "/restricted";
                });
                var btnLoginCreate = jQuery("#console-log-in-create");
                if (btnLoginCreate.length > 0) {
                    btnLoginCreate.click(function(evt) {
                        window.location = magic.config.paths.baseurl + "/restricted";
                    });
                }

                /* Logout behaviour */
                jQuery("#log-out-user").click(function (evt) {
                    evt.preventDefault();
                    jQuery("#logout-form").submit();
                });
                
                /* Create a new map */
                var btnCreateNew = jQuery("#console-create-new-map");
                if (btnCreateNew.length > 0) {
                    btnCreateNew.click(function(evt) {
                        window.open(magic.config.paths.baseurl + "/creator", "_blank");
                    });
                }
                
                /* Clear map thumbnail cache */
                var btnClearTn = jQuery("#console-clear-tn-cache");
                if (btnClearTn.length > 0) {
                    btnClearTn.click(function(evt) {
                        jQuery.getJSON(magic.config.paths.baseurl + "/clearthumbnailcache", function(data) {
                            if (data.status == "ok") {
                                bootbox.alert(
                                    '<div class="alert alert-info" style="margin-bottom:0">' + 
                                        '<p>Successfully deleted thumbnails - will recompute all on next page reload</p>' + 
                                    '</div>'
                                );
                            } else {
                                bootbox.alert(
                                    '<div class="alert alert-warning" style="margin-bottom:0">' + 
                                        '<p>Failed to delete thumbnails - error was ' + data.status + '</p>' + 
                                    '</div>'
                                );
                            }
                        });
                    });
                }
                
                /* Background colour */
                jQuery("body").css("background-color", bg);
                
                magic.runtime.webmap_panel = new magic.classes.console.WebMapPanel();
                                
            });
            
        </script>  
        <!-- /#wrapper -->        
        <form id="logout-form" method="POST" th:action="@{/logout}"></form>
    </body>
</html>
