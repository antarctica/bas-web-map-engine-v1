<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="robots" content="index, all" />
        <title>Test for OL Cesium</title>
        <link rel="stylesheet" href="../static/css/ol.css" type="text/css">
            <script src="../static/js/jquery.js"></script>
            <script src="../static/js/cesium/Cesium.js"></script>
            <script src="../static/js/cesium/olcesium.js"></script>
            <script>

                jQuery(document).ready(function () {
                    
                    const proj = ol.proj.get("EPSG:3857");
                    
                    const wmsSource = new ol.source.TileWMS({
                        url: "http://localhost:8084/proxy?url=" + encodeURIComponent("http://gis.istar.ac.uk/geoserver/istar/wms"),
                        params: {
                            "LAYERS": "BEDMAP2_Bed_and_HS",
                            "STYLES": "",
                            "TRANSPARENT": true,
                            "CRS": "EPSG:3857",
                            "SRS": "EPSG:3857",
                            "VERSION": "1.3.0",
                            "TILED": true
                        },
                        projection: proj
                    });
                    
                    const ol2d = new ol.Map({
                        layers: [
                            new ol.layer.Tile({
                                source: new ol.source.OSM()
                            }),
                            new ol.layer.Tile({
                                name: "bedmap",
                                visible: true,
                                opacity: 1.0,                                
                                source: wmsSource
                            })
                        ],
                        controls: ol.control.defaults({
                            attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
                                collapsible: false
                            })
                        }),
                        target: "map",
                        view: new ol.View({
                            center: ol.proj.transform([0, -90], "EPSG:4326", "EPSG:3857"),
                            rotation: 0.0,
                            zoom: 3,
                            projection: ol.proj.get("EPSG:3857"),
                            minZoom: 1, 
                            maxZoom: 20
                        })
                    });

                    const timeElt = jQuery("#time");
                    const ol3d = new olcs.OLCesium({
                        map: ol2d,
                        time() {
                            const val = timeElt.val();
                            if (ol3d.getCesiumScene().globe.enableLighting && val) {
                                const d = new Date();
                                d.setUTCHours(val);
                                return Cesium.JulianDate.fromDate(d);
                            }
                            return Cesium.JulianDate.now();
                        }
                    });
                    const scene = ol3d.getCesiumScene();
                    const terrainProvider = new Cesium.CesiumTerrainProvider({
                        url: "//assets.agi.com/stk-terrain/world",
                        requestVertexNormals: true
                    });
                    scene.terrainProvider = terrainProvider;
                    ol3d.setEnabled(true);


                    timeElt.css("display", "none");
                    const toggleTime = function () { // eslint-disable-line no-unused-vars
                        scene.globe.enableLighting = !scene.globe.enableLighting;
                        if (timeElt.css("display") == "none") {
                            timeElt.css("display", "inline-block");
                        } else {
                            timeElt.css("display", "none");
                        }
                    };
                });

            </script>
    </head>
    <body>
        <div id="map" style="width:100%;height:100%;"></div>
        <input type="button" value="Enable/disable" onclick="javascript:ol3d.setEnabled(!ol3d.getEnabled())" />
        <input type="button" value="Enable/disable lighting (only 3d)" onclick="javascript:toggleTime()"/>
        <select id="time">
            <option value="">Now</option>
            <option value="0">0:00</option>
            <option value="3">3:00</option>
            <option value="6">6:00</option>
            <option value="9">9:00</option>
            <option value="12">12:00</option>
            <option value="15">15:00</option>
            <option value="18">18:00</option>
            <option value="21">21:00</option>
        </select>
    </body>
</html>